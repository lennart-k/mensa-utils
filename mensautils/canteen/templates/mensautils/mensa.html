{% extends 'mensautils/base.html' %}
{% load static %}

{% block content %}
  <h1>Mensa-Speisepläne der Uni Hamburg</h1>

  {% if request.user.is_authenticated %}
    <p>Hallo, <em>{{ request.user.username }}</em>.</p>
  {% endif %}

  <div class="row">
    {% for day, canteens in mensa_data.items %}
      <div class="col-md-6">
        <h2>
          {% if day == today %}
            Heute
          {% else %}
            Nächster Öffnungstag
          {% endif %}
          ({{ day|date:"l" }})
        </h2>
        {% for canteen, entries in canteens.items %}
          <div id="canteen-{% if day == today %}0{% else %}99{% endif %}-{{ forloop.counter }}"
               class="canteen canteen-{{ forloop.counter }}" data-canteennumber="{{ forloop.counter }}">
            <h3>
              {{ canteen }}
              <a class="up-{{ forloop.counter }} move-link" href="javascript:moveCanteen(-1, {{ forloop.counter }});">
                <span class="glyphicon glyphicon-arrow-up"></span>
              </a>
              <a class="down-{{ forloop.counter }} move-link" href="javascript:moveCanteen(1, {{ forloop.counter }});">
                <span class="glyphicon glyphicon-arrow-down"></span>
              </a>
              <a class="delete-{{ forloop.counter }} delete-link" href="javascript:hideCanteen({{ forloop.counter }});">
                <span class="glyphicon glyphicon-remove"></span>
              </a>
            </h3>
            <table style="width: 100%; max-width: 700px;">
              <tr>
                <th style="width: 5%; max-width: 4px;">
                </th>
                <th style="width: 15%; max-width: 10px; text-align: right; padding-right: 15px;">
                  Preis
                </th>
                <th style="width: 15%; max-width: 10px; text-align: right; padding-right: 15px;">
                  Bed.
                </th>
                <th style="text-align: left;">
                  Gericht
                </th>
              </tr>
              {% for entry in entries %}
                <tr>
                  <td style="text-align: center;">
                    {% if entry.dish.vegetarian %}
                      <span style="color: #76a93b;">Veg.</span>
                    {% endif %}
                  </td>
                  <td style="text-align: right; padding-right: 15px;{% if entry.deprecated %} color: #c9c9c9;{% endif %}">
                    {{ entry.price }} €
                  </td>
                  <td style="text-align: right; padding-right: 15px;{% if entry.deprecated %} color: #c9c9c9;{% endif %}">
                    {{ entry.price_staff }} €
                  </td>
                  <td style="text-align: left;{% if entry.deprecated %} color: #c9c9c9;{% endif %}">
                    {{ entry.dish.name }}
                  </td>
                </tr>
              {% endfor %}
            </table>
          </div>
        {% endfor %}
      </div>
    {% endfor %}
  </div>

  <p id="showHiddenCanteensLink"><a href="javascript:showHiddenCanteens();">Ausgeblendete Mensen wieder einblenden</a></p>
  <p>
    Letzte Aktualisierung: {{ last_updated|date:"j. F Y H:i:s" }}<br />
    <a href="{% url 'mensautils.base:stats' %}">Statistiken</a> &bull;
    {% if request.user.is_authenticated %}
      <a href="{% url 'logout' %}?next={{ request.get_full_path }}">Abmelden</a>
    {% else %}
      <a href="{% url 'login' %}?next={{ request.get_full_path }}">Anmelden</a>
    {% endif %}
  <p>
{% endblock content %}

{% block additional_js %}
  <script type="text/javascript" src="{% static 'mensautils/mensa.js' %}"></script>
{% endblock additional_js %}
